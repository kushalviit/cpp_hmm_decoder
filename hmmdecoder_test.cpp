#include <stdio.h>
#include <math.h>
#include "hmmdecoder.h"

#define ABS_ERR_THRESH 0.02

mat_t actual_out[NOS][LEN]={0.9616031192,0.9049106824,0.8160719774,0.6733825338,0.4419814336,0.0560419556,0.0077627297,0.0016458674,0.0007599801,0,0.0248100523,
0.0201698785,0.0581195102,0.0717610506,0.0648446105,0.0102596301,0.0023793194,0,0.0067954362,0.0538117106,0.4228691298,	0.6340940425,0.7633084363,0.8420810962,0.8896572249,0.9176602998,0.9329318424,0.9392028926,0.9380055509,0.9290472907,	0.9101394908,0.8766627255,0.8204381784,0.727729449,0.5758865687,0.3197250226,0.318568267,0.2771246011,0.1661082607,	0.1921023359,0.5160821837,0.6978083739,0.8092074176,0.8774955743,0.9193565439,0.9450175148,0.9607478016,0.9703905214,	0.9763015181,0.9799249265,0.982145993,0.9835073536,0.9843416068,0.9848525715,0.9851650833,0.9853554929,0.9854703199,	0.985537618,0.9855738291,0.9855878,0.985582944,0.9855580747,0.9855071162,0.9854176186,0.9852677166,0.9850207871,0.9846165019,	0.9839560888,0.9828782002,0.9811194937,0.9782502938,0.9735696173,0.9659339129,0.9534776771,0.9331576866,0.9000094992,	0.8230527834,0.8998493154,0.9328771796,0.9530878086,0.9654189263,0.9728831877,0.9773042107,0.9797621097,0.9808573819,	0.9808576167,0.9797628716,0.9773056858,0.9728857363,0.965423171,0.9530947866,0.9328885957,0.8998679586,0.8230823385,	0.9000437511,0.933196436,0.9535226448,0.9659883393,0.9736390534,0.9783439577,0.9812525225,0.9830753488,0.9842577771,	0.9850886903,0.9857710915,0.9864717002,0.9873616844,0.9886584792,0.9906789086,0.9939165901,0.9991625323,0.1505996751,0,0,	0,0,0.1511388056,0.9985283449,0.9864519884,0.9721263559,0.9520515059,0.9213228871,0.8724330916,0.772071549,0.837477857,	0.8601107694,0.8669745691,0.8597461731,
0.0383968808,0.0950893176,0.1839280226,0.3266174662,0.5580185664,0.9347445295,0.9816222166,0.9875997667,0.9885051986,	0.9892009803,0.9751899477,0.9794460276,0.9418804898,0.9282389494,0.9351553895,0.9666894509,0.9701437702,0.9711305072,	0.9651550103,0.9221925225,0.5771308702,0.3659059575,0.2366915637,0.1579189038,0.1103427751,0.0823397002,0.0670681576,	0.0607971074,0.0619944491,0.0709527093,0.0898605092,0.1233372745,0.1795618216,0.272270551,0.4241134313,0.6722620688,	0.681431733,0.7228753989,0.8067014228,0.7806161575,0.4839178163,0.3021916261,0.1907925824,0.1225044257,0.0806434561,	0.0549824852,0.0392521984,0.0296094786,0.0236984819,0.0200750735,0.017854007,0.0164926464,0.0156583932,0.0151474285,	0.0148349167,0.0146445071,0.0145296801,0.014462382,0.0144261709,0.0144122,0.014417056,0.0144419253,0.0144928838,	0.0145823814,0.0147322834,0.0149792129,0.0153834981,0.0160439112,0.0171217998,0.0188805063,0.0217497062,0.0264303827,	0.0340660871,0.0465223229,0.0668423134,0.0999905008,0.1542706451,0.1001506846,0.0671228204,0.0469121914,0.0345810737,	0.0271168123,0.0226957893,0.0202378903,0.0191426181,0.0191423833,0.0202371284,0.0226943142,0.0271142637,0.034576829,	0.0469052134,0.0671114043,0.1001320414,0.1542402279,0.0999562489,0.066803564,0.0464773552,0.0340116607,0.0263609466,	0.0216560423,0.0187474775,0.0169246512,0.0157422229,0.0149113097,0.0142289085,0.0135282998,0.0126383156,0.0113415208,	0.0093210914,0.0060834099,0.0008374677,0,0,0,0,0,0,0.0014716551,0.0135480116,0.0278736441,0.0479484941,0.0786771129,	0.1275669084,0.2067442224,0.162522143,0.1398892306,0.1330254309,0.1402538269,
1.44E-45,1.29E-45,1.06E-45,6.97E-46,3.06E-45,0.009213515,0.0106150537,0.010754366,0.0107348213,0.0107990197,1.31E-44,	0.0003840939,1.34E-46,6.13E-47,6.31E-45,0.0230509189,0.0274769104,0.0288694928,0.0280495535,0.0239957668,7.81E-45,	6.65E-46,9.97E-46,1.20E-45,1.32E-45,1.39E-45,1.43E-45,1.45E-45,1.44E-45,1.42E-45,1.37E-45,1.29E-45,1.14E-45,9.05E-46,	3.08E-45,0.0080129086,2.55E-45,8.69E-45,0.0271903165,0.0272815066,9.09E-45,8.12E-46,1.10E-45,1.27E-45,1.38E-45,1.45E-45,	1.49E-45,1.51E-45,1.53E-45,1.54E-45,1.54E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,	1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.54E-45,1.54E-45,1.53E-45,1.52E-45,	1.50E-45,1.47E-45,1.42E-45,8.60E-45,0.0226765715,8.60E-45,1.42E-45,1.47E-45,1.50E-45,1.52E-45,1.53E-45,1.54E-45,1.54E-45,	1.54E-45,1.54E-45,1.53E-45,1.52E-45,1.50E-45,1.47E-45,1.42E-45,8.60E-45,0.0226774336,8.60E-45,1.42E-45,1.47E-45,1.50E-45,	1.52E-45,1.53E-45,1.54E-45,1.54E-45,1.55E-45,1.55E-45,1.55E-45,1.55E-45,1.56E-45,1.56E-45,1.56E-45,1.57E-45,2.74E-43,	0.8494003249,1,1,1,1,0.8488611944,2.72E-43,1.54E-45,1.51E-45,1.45E-45,1.38E-45,8.04E-45,0.0211842286,7.97E-45,1.29E-45,	1.31E-45,5.79E-45
};

int main()
{
//int result;
int i,j;
seq_t seq[LEN]={1,1,1,1,1,2,2,2,2,6,1,2,1,1,1,2,2,6,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,8,8,8,	2,1,1,1,1,1,1,2,1,1,1,1};
mat_t transition[NOS][NOS]={0.9440,0.0395,0.0165,
                          0.0759,0.9241,0,
                          0.2191,0,0.7809};
mat_t emmision[NOS][NOE]={0.9595,0.0405,0,0,0,0,0,0,
                           0.6017,0.3308,0,0,0,0.0596,0,0,
                           0,0.2776,0,0,0,0.3215,0,0.4009};
mat_t out[NOS][LEN];
unsigned err_cnt = 0;
float abs_err;

hmm_decoder(seq,transition,emmision,out);

for(i=0;i<NOS;i++)
{ 
 for(j=0;j<LEN;j++) 
  {
    abs_err = out[i][j] - actual_out[i][j];
    if (fabs(abs_err) > ABS_ERR_THRESH) {
        printf("Error threshold exceeded: i,j = %d , %d \n",i,j);
         printf("  Expected: %f \n",actual_out[i][j]);
          printf("  Got: %f \n",out[i][j]);
          printf("  Delta: %f \n",abs_err);
         err_cnt++;
      }
  }
}

if (err_cnt) {
      printf( "!!! TEST FAILED - %d \n",err_cnt);
      printf(" results out of tolerance.\n");
   } 
else
     printf("Test Passed \n");

return err_cnt;
}

